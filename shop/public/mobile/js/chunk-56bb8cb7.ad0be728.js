(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56bb8cb7"],{"33ef":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return s})),a.d(e,"c",(function(){return r}));var n=a("366f"),i=function(t,e){return Object(n["a"])("/Marketmanage/get_info","GET",{marketmanage_id:t,key:e})},s=function(t){return Object(n["a"])("/member_marketmanage/add_log","POST",{marketmanage_id:t},"member")},r=function(t){return Object(n["a"])("/member_marketmanage/get_log","POST",{page:t.page,per_page:t.per_page},"member")}},"36bd":function(t,e,a){"use strict";var n=a("4bf8"),i=a("77f1"),s=a("9def");t.exports=function(t){var e=n(this),a=s(e.length),r=arguments.length,o=i(r>1?arguments[1]:void 0,a),c=r>2?arguments[2]:void 0,l=void 0===c?a:i(c,a);while(l>o)e[o++]=t;return e}},"5af2":function(t,e,a){t.exports=function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.i=function(t){return t},a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=242)}({0:function(t,e){t.exports=function(t,e,a,n,i){var s,r=t=t||{},o=typeof t.default;"object"!==o&&"function"!==o||(s=t,r=t.default);var c,l="function"===typeof r?r.options:r;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns),n&&(l._scopeId=n),i?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},l._ssrRegister=c):a&&(c=a),c){var d=l.functional,u=d?l.render:l.beforeCreate;d?l.render=function(t,e){return c.call(e),u(t,e)}:l.beforeCreate=u?[].concat(u,c):[c]}return{esModule:s,exports:r,options:l}}},1:function(t,e){t.exports=a("2b0e")},101:function(t,e){},164:function(t,e,a){function n(t){a(101)}var i=a(0)(a(86),a(170),n,null,null);t.exports=i.exports},170:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"mint-toast-pop"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"mint-toast",class:t.customClass,style:{padding:""===t.iconClass?"10px":"20px"}},[""!==t.iconClass?a("i",{staticClass:"mint-toast-icon",class:t.iconClass}):t._e(),t._v(" "),a("span",{staticClass:"mint-toast-text",style:{"padding-top":""===t.iconClass?"0":"10px"}},[t._v(t._s(t.message))])])])},staticRenderFns:[]}},242:function(t,e,a){t.exports=a(50)},50:function(t,e,a){"use strict";var n=a(94);Object.defineProperty(e,"__esModule",{value:!0}),a.d(e,"default",(function(){return n["a"]}))},86:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={props:{message:String,className:{type:String,default:""},position:{type:String,default:"middle"},iconClass:{type:String,default:""}},data:function(){return{visible:!1}},computed:{customClass:function(){var t=[];switch(this.position){case"top":t.push("is-placetop");break;case"bottom":t.push("is-placebottom");break;default:t.push("is-placemiddle")}return t.push(this.className),t.join(" ")}}}},94:function(t,e,a){"use strict";var n=a(1),i=a.n(n),s=i.a.extend(a(164)),r=[],o=function(){if(r.length>0){var t=r[0];return r.splice(0,1),t}return new s({el:document.createElement("div")})},c=function(t){t&&r.push(t)},l=function(t){t.target.parentNode&&t.target.parentNode.removeChild(t.target)};s.prototype.close=function(){this.visible=!1,this.$el.addEventListener("transitionend",l),this.closed=!0,c(this)};var d=function(t){void 0===t&&(t={});var e=t.duration||3e3,a=o();return a.closed=!1,clearTimeout(a.timer),a.message="string"===typeof t?t:t.message,a.position=t.position||"middle",a.className=t.className||"",a.iconClass=t.iconClass||"",document.body.appendChild(a.$el),i.a.nextTick((function(){a.visible=!0,a.$el.removeEventListener("transitionend",l),~e&&(a.timer=setTimeout((function(){a.closed||a.close()}),e))})),a};e["a"]=d}})},"5fc6":function(t,e,a){},"61d5":function(t,e,a){t.exports=a.p+"img/home-marketcard-cover.504261b7.png"},"6c7b":function(t,e,a){var n=a("5ca1");n(n.P,"Array",{fill:a("36bd")}),a("9c6c")("fill")},bb34:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home-marketcard"},[t._m(0),a("div",{staticClass:"scratchcard-bg"},[a("div",{staticClass:"scratchcard",style:"width:"+t.cardWidth+"px; height:"+t.cardHeight+"px"},[a("canvas",{ref:"canvas",staticClass:"scratchcard-overlay",on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,touchstart:t.handleMouseDown,touchmove:t.handleMouseMove,touchend:t.handleMouseUp}}),t.overlayLoaded?a("div",{staticClass:"scratchcard-content"},[t.isResult?a("div",[a("div",{staticClass:"result-area",class:t.drawResult?"suc":"fail"},[a("div",{staticClass:"face-area"}),a("div",{staticClass:"result-content-wap"},[a("p",{staticClass:"result-title"},[t._v(t._s(t.drawTitle))]),a("p",{staticClass:"result-content"},[t._v(t._s(t.drawContent))])])])]):t._e()]):t._e()])]),t.marketmanage_info?a("div",{staticClass:"marketcard-info"},[a("div",{staticClass:"title"},[t._v("活动名称：")]),a("div",{staticClass:"content"},[t._v(t._s(t.marketmanage_info.marketmanage_name))]),a("div",{staticClass:"title"},[t._v("活动介绍：")]),a("div",{staticClass:"content"},[t._v(t._s(t.marketmanage_info.marketmanage_detail))]),a("div",{staticClass:"title"},[t._v("活动有效时间：")]),a("div",{staticClass:"content"},[t._v(t._s(t.marketmanage_info.marketmanage_begintime_text)+"至"+t._s(t.marketmanage_info.marketmanage_endtime_text))]),a("div",{staticClass:"title"},[t._v("活动奖项设置：")]),a("div",{staticClass:"content"},t._l(t.marketmanageaward_list,(function(e,n){return a("div",{key:n},[t._v(t._s(e.marketmanageaward_level)+"等奖"+t._s(e.marketmanageaward_probability)+"%："+t._s(e.marketmanageaward_text))])})),0)]):t._e(),a("div",{staticClass:"btn-wrapper"},[a("div",{staticClass:"btn"},[t.canDraw?a("mt-button",{attrs:{size:"large",type:"primary"},on:{click:t.reset}},[t._v("再刮一次")]):a("mt-button",{attrs:{size:"large",type:"primary",disabled:""}},[t._v("机会用完了")])],1),a("div",{staticClass:"btn"},[a("mt-button",{attrs:{size:"large",type:"primary"},on:{click:t.goLog}},[t._v("刮奖记录")])],1)])])},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"marketcard-logo"},[n("img",{attrs:{src:a("c60d")}})])}],s=(a("8e6e"),a("ac6a"),a("456d"),a("6c7b"),a("5fc6"),a("5af2")),r=a.n(s),o=a("bd86"),c=a("33ef"),l=a("2f62");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(a,!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(a).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={data:function(){return{marketmanage_id:0,marketmanage_info:!1,marketmanageaward_list:!1,overlayLoaded:!0,isDrawing:!1,isFinished:!1,canvas:void 0,ctx:void 0,lastPoint:void 0,brush:new Image,imageUrl:a("61d5"),cardWidth:260,cardHeight:132,finishPercent:70,forceReveal:!1,isScrape:!1,isResult:!1,drawResult:!1,drawTitle:"真遗憾，未中奖",drawContent:"哎呀，肯定姿势不对！",canDraw:!1}},computed:u({},Object(l["d"])({isOnline:function(t){return t.member.isOnline},token:function(t){return t.member.token}})),created:function(){var t=this;this.marketmanage_id=this.$route.query.marketmanage_id,this.marketmanage_id?Object(c["b"])(this.marketmanage_id,this.token).then((function(e){t.marketmanage_info=e.result.marketmanage_info,t.marketmanageaward_list=e.result.marketmanageaward_list,t.canDraw=e.result.can_draw,t.drawContent=t.marketmanage_info.marketmanage_failed,t.canDraw||r()(e.message)})).catch((function(t){r()(t.message)})):r()("参数错误")},methods:{goLog:function(){this.$router.push({name:"MemberMarketmanagelog"})},initCanvas:function(){this.canvas=this.$refs.canvas,this.canvas.width=this.cardWidth,this.canvas.height=this.cardHeight,this.ctx=this.canvas.getContext("2d")},drawImage:function(){var t=this,e=new Image;e.crossOrigin="Anonymous",e.src=this.imageUrl+"?"+Math.random(),e.onload=function(){t.ctx.drawImage(e,0,0,264,147),t.overlayLoaded=!0}},scratchAt:function(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,25,0,2*Math.PI,!1),this.ctx.fill()},handleMouseDown:function(t){this.isOnline?this.marketmanage_info&&(this.isDrawing=!0,this.lastPoint=this.getMouse(t,this.canvas)):this.$router.push({name:"HomeMemberLogin"})},handleMouseUp:function(){this.isDrawing=!1},handleMouseMove:function(t){var e=this;if(this.canDraw&&this.isDrawing){t.preventDefault();for(var a,n,i=this.getMouse(t,this.canvas),s=this.distanceBetween(this.lastPoint,i),o=this.angleBetween(this.lastPoint,i),l=0;l<s;l++)a=this.lastPoint.x+Math.sin(o)*l,n=this.lastPoint.y+Math.cos(o)*l,this.ctx.globalCompositeOperation="destination-out",this.scratchAt(a,n);this.lastPoint=i,this.handlePercentage(this.getFilledPercent(this.ctx,this.cardWidth,this.cardHeight,32)),this.isScrape||(this.isScrape=!0,Object(c["a"])(this.marketmanage_id).then((function(t){e.canDraw=t.result.can_draw,e.isResult=!0,t.result.draw_result&&(e.drawResult=!0,e.drawTitle="恭喜你，获得"+t.result.draw_info.marketmanageaward_level+"等奖",e.drawContent=t.result.draw_info.marketmanageaward_text)})).catch((function(t){r()(t.message)})))}},handlePercentage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t>this.finishPercent&&this.reveal()},reveal:function(){this.isFinished,this.isFinished=!0},getFilledPercent:function(t,e,a,n){(!n||n<1)&&(n=1);for(var i=t.getImageData(0,0,e,a),s=i.data.length/n,r=0,o=0;o<i.data.length;o+=n)0===parseInt(i.data[o],10)&&r++;return Math.round(r/s*100)},getMouse:function(t,e){var a=e.getBoundingClientRect(),n=a.left,i=a.top,s=t.touches&&t.touches[0];if(s)return{x:s.clientX-n,y:s.clientY-i};var r=window.pageYOffset||document.documentElement.scrollTop,o=window.pageXOffset||document.documentElement.scrollLeft;return{x:t.pageX-n-o,y:t.pageY-i-r}},distanceBetween:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},angleBetween:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reset:function(){this.isScrape=!1,this.drawResult=!1,this.isFinished=!1,this.isResult=!1,this.initCanvas(),this.drawImage(),this.drawTitle="真遗憾，未中奖",this.drawContent=this.marketmanage_info.marketmanage_failed}},watch:{forceReveal:function(t){t&&this.reveal()}},mounted:function(){this.initCanvas(),this.drawImage()}},f=m,h=(a("e4a7"),a("2877")),p=Object(h["a"])(f,n,i,!1,null,"6b4ec2af",null);e["default"]=p.exports},c60d:function(t,e,a){t.exports=a.p+"img/home-marketcard-logo.4802e276.png"},dee1:function(t,e,a){},e4a7:function(t,e,a){"use strict";var n=a("dee1"),i=a.n(n);i.a}}]);